<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Your Rice Purity Score</title>
    <link rel="shortcut icon" type="image/png" href="../favicon.png">
    <link rel="stylesheet" href="../style.css">

    <!-- META -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZW9TZJ46CP"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-ZW9TZJ46CP');
    </script>

    <script>
      const gtagScore = sessionStorage.getItem("score");
      gtag('event', 'page_view', {
        page_location: window.location.href,
        page_path: window.location.pathname + window.location.search,
        page_title: `Your Rice Purity Score: ${gtagScore}`
      });
    </script>

    <!-- Ads -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3772914411949506" crossorigin="anonymous"></script>
  </head>
  <body>

    <p>
      <a href="https://ricethresher.org">
        <img src="../thresherOfficial.png" alt="Rice Thresher Logo">
      </a>
    </p>

    <p><i>
      The Purity Test has historically served as a segue from O-week to true college life at Rice.<br />
      It's a voluntary opportunity for O-week groups to bond, and for students to track the maturation<br />
      of their experiences throughout college.
    </i></p>
    <p><strong>
      Caution: This is not a bucket list. Completion of all items on this test will likely result in death.
    </strong></p>

    <!-- Score Header -->
    <ins class="adsbygoogle"
        style="display:block"
        data-ad-client="ca-pub-3772914411949506"
        data-ad-slot="7501839623"
        data-ad-format="auto"
        data-full-width-responsive="true"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>

    <h2>Your score:</h2>
    <h1 id="score">--</h1>

    <div id="share" style="margin-top: 1em;">
      <a id="restart" href="../"><button onclick="restartEvent()">Take again!</button></a>
      <button onclick="copyLink()">Copy Link</button>
      <a id="text-share" href="#"><button onclick="textEvent()">Share via Text</button></a>
      <a id="x-share" href="#" target="_blank" rel="noopener noreferrer"><button onclick="xEvent()">Share on X</button></a>
    </div>    

    <p>Thank you for your submission!</p>
    <p>
      The Rice Purity test was created by 
      <a class = "thresher-link" href="https://www.ricethresher.org/" target="_blank">the Rice Thresher</a>
      newspaper at Rice University.
    </p>

    <ins class="adsbygoogle"
        style="display:block"
        data-ad-format="autorelaxed"
        data-ad-client="ca-pub-3772914411949506"
        data-ad-slot="7726992915"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>

    <script>
      const params = new URLSearchParams(window.location.search);

      const urlScore = params.get("score");
      const score = sessionStorage.getItem("score");

      if (urlScore != score) {
        // no cheating!
        window.location.href = `../`;
      }

      if (score) {
        document.getElementById("score").textContent = score;
      }
    </script>

    <script>
      const scoreText = score ? `I got a ${score} on the Rice Purity Test!` : '';
      const shareURL = window.location.origin;

      function copyLink() {
        navigator.clipboard.writeText(shareURL).then(() => {
          alert("Link copied to clipboard!");
        });

        gtag('event', 'copy_link', {
          'event_category': 'Sharing',
          'event_label': 'Copied to Clipboard',
          'value': 1
        });
      }

      function restartEvent() {
        gtag('event', 'restart_test', {
          'event_category': 'Quiz Interaction',
          'event_label': 'Restart Button Click',
          'value': 1
        });
      }

      function textEvent() {
        gtag('event', 'sms_share', {
          'event_category': 'Sharing',
          'event_label': 'Share to SMS',
          'value': 1
        });
      }

      function xEvent() {
        gtag('event', 'x_share', {
          'event_category': 'Sharing',
          'event_label': 'Share to X',
          'value': 1
        });
      }

      // Text message link
      const smsMessage = `${scoreText} Check yours here: ${shareURL}`;
      document.getElementById("text-share").href = `sms:?&body=${encodeURIComponent(smsMessage)}`;

      // X (Twitter) share link
      const xLink = `https://twitter.com/intent/tweet?text=${encodeURIComponent(scoreText)}&url=${encodeURIComponent(shareURL)}`;
      document.getElementById("x-share").href = xLink;
    </script>

  </body>
</html>
